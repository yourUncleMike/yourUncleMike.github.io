<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8'>
<title>which craft</title>
<style>
 button, li { font-size: 20px; }
 button     { font-family: monospace; border-width: 2px; padding: 1px 6px; }
         li { padding-bottom: 10px; }
 span    { font-size: 20px; font-family: sans-serif; }
 th, td  { font-size: 20px; font-family: monospace; vertical-align: top; text-align: left; padding-bottom: 10px; padding-left: 10px; }
 h1, h2  { text-align: center }
 h1      { font-size: 64px; }
     h2  { font-size: 32px; }
 pre     { display: inline; }
</style>
<script>
 function reveal(button) {
  span = button.nextElementSibling;
  div = span.nextElementSibling;
  div.hidden = button.textContent[0] == "+";
  span.style.fontWeight = div.hidden ? "bold" : "normal";
 }
 function toggle(button) {
  button.textContent = (button.textContent[0] == "-" ? "+" : "-");
  reveal(button);
 }
 function init() {
  buttons = document.getElementsByTagName("button");
  for (var i in buttons) reveal(buttons[i]);
 }
</script>
</head>

<body onload="init()">

<h1>which craft</h1>
<h2>An introduction to how the BASH shell figures<br>out what to run when you enter a command.</h2>
<hr>

<div>
<button onclick="toggle(this)">-</button> <span>References</span>
<div>
<hr>
<table>
<tr><th>&nbsp;</th><th><a target="_blank" href="https://www.gnu.org/software/bash/manual/html_node/index.html">Bash Reference Manual</a></th></tr>
<tr><th>3.2.1 </th><td><a target="_blank" href="https://www.gnu.org/software/bash/manual/html_node/Simple-Commands.html">Simple Commands</a></td></tr>
<tr><th>3.7.2 </th><td><a target="_blank" href="https://www.gnu.org/software/bash/manual/html_node/Command-Search-and-Execution.html">Command Search and Execution</a></td></tr>
<tr><th>4.2 </th><td><a target="_blank" href="https://www.gnu.org/software/bash/manual/html_node/Bash-Builtins.html">Builtin Commands</a></td></tr>
<tr><th>3.3 </th><td><a target="_blank" href="https://www.gnu.org/software/bash/manual/html_node/Shell-Functions.html">Shell Functions</a></td></tr>
<tr><th>6.6 </th><td><a target="_blank" href="https://www.gnu.org/software/bash/manual/html_node/Aliases.html">Aliases</a></td><td style="color: red">(What 3.7.2 did <i>not</i> tell you.)</td></tr>
<tr>
 <th>&nbsp;</th>
 <td colspan=2>
  <div width="512px">
   <button onclick="toggle(this)">+</button> <span>TL;DR</span>
   <div>
    <hr>
     NAME [OPTION]...
     <ol>
     <li>If NAME contains "/", execute it as literal path.</li>
     <li>If NAME is an alias, substitute the alias value for NAME.
     <br>If resulting NAME is different go to step 1.</li>
     <li>If NAME is a function, execute the function.</li>
     <li>If NAME is a BASH builtin, execute the builtin command.</li>
     <li>Search $PATH for NAME and run the first matching executable.</li>
     </ol>
    <hr>
   </div>
  </div>
 </td>
</tr>
</table>
<hr>
</div>
</div>

<div>
<button onclick="toggle(this)">+</button> <span>man which</span>
<div>
<hr>
<table>
<tr><td></td><td><pre>
<b>NAME</b>
       which - locate a command<br>
<b>SYNOPSIS</b>
       which [-a] filename ...<br>
<b>DESCRIPTION</b>
       <b>which</b> returns the pathnames of the files (or links) which would be 
       executed in the current environment, had its arguments been given
       as commands in a strictly POSIX-conformant shell.  It does this by
       searching the PATH for executable files matching the names of the
       arguments.  It does not follow symbolic links.<br>
<b>OPTIONS</b>
       <b>-a</b>     print all matching pathnames of each argument</pre></td></tr>
</table>
<hr>
</div>
</div>

<div>
<button onclick="toggle(this)">+</button> <span>basic which craft</span>
<div>
<hr>
<table>

<tr><td><br>$</td><th><br>which which</th></tr>
<tr><td></td><td>/usr/bin/which</td></tr>

<tr><td><br>$</td><th><br>which -a which</th></tr>
<tr><td></td><td>/usr/bin/which<br>
                 /bin/which</td></tr>

<tr><td><br>$</td><th><br>which -a which | xargs -I{} stat -c %N {}</th></td>
<tr><td></td><td>'/usr/bin/which' -> '/bin/which'<br>
                 '/bin/which'</td></tr>

</table>
<hr>
</div>
</div>

<div>
<button onclick="toggle(this)">+</button> <span>printf (practice target)</span>
<div>
<hr>
<table>

<tr><td><br>$</td><th><br>printf 'Hello %s\n' 'Mr. Bond'<th></tr>
<tr><td></td><td>Hello Mr. Bond</td></tr>

<tr><td><br>$</td><th><br>printf -v greeting 'Hello %s\n' James<th></tr>
<tr><td>$</td><th>echo $greeting</th></tr>
<tr><td></td><td>Hello James</td></tr>

<tr><td><br>$</td><th><br>which printf</th></tr>
<tr><td></td><td>/usr/bin/printf</td></tr>

<tr><td><br>$</td><th><br>/usr/bin/printf -v greeting Aloha ; echo '$?'=$? greeting=$greeting</th><td style="color: red;"><br># WTF moment</td></tr>
<tr><td></td><td>-v/usr/bin/printf: warning: ignoring excess arguments, starting with ‘greeting’
             <br>$?=0 greeting=Hello James</td></tr>

</table>
<hr>
</div>
</div>

<div>
<button onclick="toggle(this)">+</button> <span>builtins</span>
<div>
<hr>
<table>

<tr><td><br>$</td><th><br>builtin printf -v greeting Aloha ; echo '$?'=$? greeting=$greeting</th></tr>
<tr><td></td><td>$?=0 greeting=Aloha</td></tr>

<tr><td><br>$</td><th><br>builtin printf || echo '$?'=$?</th></tr>
<tr><td></td><td>printf: usage: printf [-v var] format [arguments]
             <br>$?=2</td></tr>

<tr><td><br>$</td><th><br>builtin ls || echo '$?'=$?</th></tr>
<tr><td></td><td>bash: builtin: ls: not a shell builtin
             <br>$?=1</td></tr>

</table>
<hr>
</div>
</div>

<div>
<button onclick="toggle(this)">+</button> <span>functions</span>
<div>
<hr>
<table>

<tr><td><br>$</td><th><br>function printf { echo -n function:\ ; builtin printf "$@"; }</td></tr>
<tr><td>$</td><th>printf 'Hello %s\n' Michael</td></tr>
<tr><td></td><td>function: Hello Michael</td></tr>

<tr><td><br>$</td><th><br>which printf</th></tr>
<tr><td></td><td>/usr/bin/printf</td></tr>

<tr><td><br>$</td><th><br>declare -f printf || echo '$?'=$?</th></tr>
<tr><td></td><td><pre>printf ()
{
  echo -n function:\ ;
  builtin printf "$@"
}</pre></td></tr>

<tr><td><br>$</td><th><br>declare -f ls || echo '$?'=$?</th></tr>
<tr><td></td><td>$?=1</td></tr>

</table>
<hr>
</div>
</div>

<div>
<button onclick="toggle(this)">+</button> <span>aliases</span>
<div>
<hr>
<table>

<tr><td><br>$</td><th><br>alias printf='echo -n alias:\ ; printf'</th></tr>
<tr><td>$</td><th>printf 'Hello %s\n' Michael</th><td style="color: red"># WTF moment</td></tr>
<tr><td></td><td>alias: function: Hello Michael</td></tr>

<tr><td><br>$</td><th><br>alias printf='echo -n alias:\ ; /usr/bin/printf'</th></tr>
<tr><td>$</td><th>printf 'Hello %s\n' Michael</th></tr>
<tr><td></td><td>alias: Hello Michael</td></tr>

<tr><td><br>$</td><th><br>which printf</th></tr>
<tr><td></td><td>/usr/bin/printf</td></tr>

<tr><td><br>$</td><th><br>alias printf || echo '$?'=$?</th></tr>
<tr><td></td><td>alias printf='echo -n alias:\ ; /usr/bin/printf'</td></tr>

<tr><td><br>$</td><th><br>alias pwd || echo '$?'=$?</th></tr>
<tr><td></td><td>bash: alias: pwd: not found
             <br>$?=1</td></tr>

</table>
<hr>
</div>
</div>

<div>
<button onclick="toggle(this)">+</button> <span>Putting it all together (<b>alias</b>, <b>declare -f</b>, <b>type -t</b>, and <b>which</b>)</span>
<div>
<hr>
<table>

<tr><td><br>$</td><th><br><pre>function which {<span style="color: red">   # Success !~}></span>
  local _fmt=%n _opt='' _all=continue _cmd
  case "$1" in
    -a) _fmt=%N _opt=-a _all=true; shift ;;
    -*) \builtin printf 'Illegal option %s\nUsage: which [-a] args\n' "$1"; return 2 ;;
  esac
  for _cmd in "$@"; do 
    \builtin alias "$_cmd" 2&gt;/dev/null &amp;&amp; $_all
    \builtin declare -f "$_cmd" &amp;&amp; $_all
    \builtin "$_cmd" &amp;&gt;/dev/null ; [ $? -ne 1 ] &amp;&amp; echo builtin $_cmd &amp;&amp; $_all
    env which $_opt "$_cmd" | xargs -I{} stat -c $_fmt {}
  done }</pre></th></tr>

<tr><td><br>$</td><th><br><pre>function which {<span style="color: red">    # A longer but cleaner implementation</span>
  local _fmt=%n _opt='' _cmd _type
  case "$1" in
    -a) _fmt=%N _opt=-a; shift ;;
    -*) \builtin printf 'Illegal option %s\nUsage: which [-a] args\n' "$1"; return 2 ;;
  esac
  for _cmd in "$@"; do
    for _type in $(type -t $_opt "$_cmd" | uniq); do
      case $_type in
        alias)    \builtin alias "$_cmd" 2&gt;/dev/null ;;
        function) echo -n 'function '; \builtin declare -f "$_cmd" ;;
        builtin)  echo builtin $_cmd ;;
        file)     env which $_opt "$_cmd" | xargs -I{} stat -c $_fmt {} ;;
      esac
    done
  done }</pre></th></tr>

<tr><td><br>$</td><th><br>type -at printf</th><td style="color: red"># Facepalm</td></tr>
<tr><td></td><td>alias<br>function<br>builtin<br>file</td></tr>

<tr><td><br>$</td><th><br>which printf</th></tr>
<tr><td></td><td>alias printf='echo -n alias:\ ; /usr/bin/printf'</td></tr>

<tr><td><br>$</td><th><br>unalias printf</th></tr>
<tr><td>$</td><th>which printf</th></tr>
<tr><td></td><td><pre>function printf ()
{
    echo -n function:\ ;
    builtin printf "$@"
}</pre></td></tr>

<tr><td><br>$</td><th><br>unset -f printf</th></tr>
<tr><td>$</td><th>which -a printf</th></tr>
<tr><td></td><td>builtin printf</td></tr>
<tr><td></td><td>'/usr/bin/printf'</td></tr>

<tr><td><br>$</td><th><br>which -a which</th></tr>
<tr><td></td><td><pre>function which () 
{ 
    local _fmt=%n _opt='' _cmd _type;
    case "$1" in 
        -a)
            _fmt=%N _opt=-a;
            shift
        ;;
        -*)
            \builtin printf 'Illegal option %s\nUsage: which [-a] args\n' "$1";
            return 2
        ;;
    esac;
    for _cmd in "$@";
    do
        for _type in $(type -t $_opt "$_cmd" | uniq);
        do
            case $_type in 
                alias)
                    \builtin alias "$_cmd" 2> /dev/null
                ;;
                function)
                    echo -n 'function ';
                    \builtin declare -f "$_cmd"
                ;;
                builtin)
                    echo builtin $_cmd
                ;;
                file)
                    env which $_opt "$_cmd" | xargs -I{} stat -c $_fmt {}
                ;;
            esac;
        done;
    done
}</pre></td></tr>
<tr><td></td><td>'/usr/bin/which' -> '/bin/which'
             <br>'/bin/which'</td></tr>


</table>
<hr>
</div>
</div>


</body>
</html>
